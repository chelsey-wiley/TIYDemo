{"version":3,"sources":["script.js"],"names":["navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","msGetUserMedia","getBrowser","constraints","audio","video","width","min","ideal","max","height","recBtn","document","querySelector","pauseResBtn","stopBtn","videoElement","dataElement","downloadLink","controls","errorCallback","error","console","log","mediaRecorder","chunks","count","startRecording","stream","MediaRecorder","isTypeSupported","options","mimeType","textContent","start","url","window","URL","webkitURL","src","createObjectURL","play","ondataavailable","e","push","data","onerror","onstart","state","onstop","blob","Blob","type","videoURL","href","innerHTML","rand","Math","floor","random","name","setAttribute","onpause","onresume","onwarning","onBtnRecordClicked","alert","disabled","onBtnStopClicked","stop","onPauseResumeClicked","pause","resume","message","nVer","appVersion","nAgt","userAgent","browserName","appName","fullVersion","parseFloat","majorVersion","parseInt","nameOffset","verOffset","ix","indexOf","substring","lastIndexOf","toLowerCase","toUpperCase","isNaN"],"mappings":"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","file":"script.js","sourcesContent":["'use strict';\n\n/* globals MediaRecorder */\n\n// Spec is at http://dvcs.w3.org/hg/dap/raw-file/tip/media-stream-capture/RecordingProposal.html\n//https://addpipe.com/blog/mediarecorder-api/\n\nnavigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;\n\n\nif(getBrowser() == \"Chrome\"){\n\tvar constraints = {\"audio\": true, \"video\": {  \"mandatory\": {  \"minWidth\": 640,  \"maxWidth\": 640, \"minHeight\": 480,\"maxHeight\": 480 }, \"optional\": [] } };//Chrome\n}else if(getBrowser() == \"Firefox\"){\n\tvar constraints = {audio: true,video: {  width: { min: 640, ideal: 640, max: 640 },  height: { min: 480, ideal: 480, max: 480 }}}; //Firefox\n}\n\nvar recBtn = document.querySelector('button#rec');\nvar pauseResBtn = document.querySelector('button#pauseRes');\nvar stopBtn = document.querySelector('button#stop');\n\nvar videoElement = document.querySelector('video');\nvar dataElement = document.querySelector('#data');\nvar downloadLink = document.querySelector('a#downloadLink');\n\nvideoElement.controls = false;\n\nfunction errorCallback(error){\n\tconsole.log('navigator.getUserMedia error: ', error);\n}\n\n/*\nvar mediaSource = new MediaSource();\nmediaSource.addEventListener('sourceopen', handleSourceOpen, false);\nvar sourceBuffer;\n*/\n\nvar mediaRecorder;\nvar chunks = [];\nvar count = 0;\n\nfunction startRecording(stream) {\n\tlog('Start recording...');\n\tif (typeof MediaRecorder.isTypeSupported == 'function'){\n\t\t/*\n\t\t\tMediaRecorder.isTypeSupported is a function announced in https://developers.google.com/web/updates/2016/01/mediarecorder and later introduced in the MediaRecorder API spec http://www.w3.org/TR/mediastream-recording/\n\t\t*/\n\t\tif (MediaRecorder.isTypeSupported('video/webm;codecs=h264')) {\n\t\t  var options = {mimeType: 'video/webm;codecs=h264'};\n\t\t} else if (MediaRecorder.isTypeSupported('video/webm;codecs=vp9')) {\n\t\t  var options = {mimeType: 'video/webm;codecs=vp9'};\n\t\t} else if (MediaRecorder.isTypeSupported('video/webm;codecs=vp8')) {\n\t\t  var options = {mimeType: 'video/webm;codecs=vp8'};\n\t\t}\n\t\tlog('Using '+options.mimeType);\n\t\tmediaRecorder = new MediaRecorder(stream, options);\n\t}else{\n\t\tlog('Using default codecs for browser');\n\t\tmediaRecorder = new MediaRecorder(stream);\n\t}\n\n\tpauseResBtn.textContent = \"Pause\";\n\n\tmediaRecorder.start(10);\n\n\tvar url = window.URL || window.webkitURL;\n\tvideoElement.src = url ? url.createObjectURL(stream) : stream;\n\tvideoElement.play();\n\n\tmediaRecorder.ondataavailable = function(e) {\n\t\t//log('Data available...');\n\t\t//console.log(e.data);\n\t\t//console.log(e.data.type);\n\t\t//console.log(e);\n\t\tchunks.push(e.data);\n\t};\n\n\tmediaRecorder.onerror = function(e){\n\t\tlog('Error: ' + e);\n\t\tconsole.log('Error: ', e);\n\t};\n\n\n\tmediaRecorder.onstart = function(){\n\t\tlog('Started & state = ' + mediaRecorder.state);\n\t};\n\n\tmediaRecorder.onstop = function(){\n\t\tlog('Stopped  & state = ' + mediaRecorder.state);\n\n\t\tvar blob = new Blob(chunks, {type: \"video/webm\"});\n\t\tchunks = [];\n\n\t\tvar videoURL = window.URL.createObjectURL(blob);\n\n\t\tdownloadLink.href = videoURL;\n\t\tvideoElement.src = videoURL;\n\t\tdownloadLink.innerHTML = 'Download video file';\n\n\t\tvar rand =  Math.floor((Math.random() * 10000000));\n\t\tvar name  = \"video_\"+rand+\".webm\" ;\n\n\t\tdownloadLink.setAttribute( \"download\", name);\n\t\tdownloadLink.setAttribute( \"name\", name);\n\t};\n\n\tmediaRecorder.onpause = function(){\n\t\tlog('Paused & state = ' + mediaRecorder.state);\n\t}\n\n\tmediaRecorder.onresume = function(){\n\t\tlog('Resumed  & state = ' + mediaRecorder.state);\n\t}\n\n\tmediaRecorder.onwarning = function(e){\n\t\tlog('Warning: ' + e);\n\t};\n}\n\n//function handleSourceOpen(event) {\n//  console.log('MediaSource opened');\n//  sourceBuffer = mediaSource.addSourceBuffer('video/webm; codecs=\"vp9\"');\n//  console.log('Source buffer: ', sourceBuffer);\n//}\n\nfunction onBtnRecordClicked (){\n\t if (typeof MediaRecorder === 'undefined' || !navigator.getUserMedia) {\n\t\talert('MediaRecorder not supported on your browser, use Firefox 30 or Chrome 49 instead.');\n\t}else {\n\t\tnavigator.getUserMedia(constraints, startRecording, errorCallback);\n\t\trecBtn.disabled = true;\n\t\tpauseResBtn.disabled = false;\n\t\tstopBtn.disabled = false;\n\t}\n}\n\nfunction onBtnStopClicked(){\n\tmediaRecorder.stop();\n\tvideoElement.controls = true;\n\n\trecBtn.disabled = false;\n\tpauseResBtn.disabled = true;\n\tstopBtn.disabled = true;\n}\n\nfunction onPauseResumeClicked(){\n\tif(pauseResBtn.textContent === \"Pause\"){\n\t\tconsole.log(\"pause\");\n\t\tpauseResBtn.textContent = \"Resume\";\n\t\tmediaRecorder.pause();\n\t\tstopBtn.disabled = true;\n\t}else{\n\t\tconsole.log(\"resume\");\n\t\tpauseResBtn.textContent = \"Pause\";\n\t\tmediaRecorder.resume();\n\t\tstopBtn.disabled = false;\n\t}\n\trecBtn.disabled = true;\n\tpauseResBtn.disabled = false;\n}\n\n\nfunction log(message){\n\tdataElement.innerHTML = dataElement.innerHTML+'<br>'+message ;\n}\n\n\n\n//browser ID\nfunction getBrowser(){\n\tvar nVer = navigator.appVersion;\n\tvar nAgt = navigator.userAgent;\n\tvar browserName  = navigator.appName;\n\tvar fullVersion  = ''+parseFloat(navigator.appVersion);\n\tvar majorVersion = parseInt(navigator.appVersion,10);\n\tvar nameOffset,verOffset,ix;\n\n\t// In Opera, the true version is after \"Opera\" or after \"Version\"\n\tif ((verOffset=nAgt.indexOf(\"Opera\"))!=-1) {\n\t browserName = \"Opera\";\n\t fullVersion = nAgt.substring(verOffset+6);\n\t if ((verOffset=nAgt.indexOf(\"Version\"))!=-1)\n\t   fullVersion = nAgt.substring(verOffset+8);\n\t}\n\t// In MSIE, the true version is after \"MSIE\" in userAgent\n\telse if ((verOffset=nAgt.indexOf(\"MSIE\"))!=-1) {\n\t browserName = \"Microsoft Internet Explorer\";\n\t fullVersion = nAgt.substring(verOffset+5);\n\t}\n\t// In Chrome, the true version is after \"Chrome\"\n\telse if ((verOffset=nAgt.indexOf(\"Chrome\"))!=-1) {\n\t browserName = \"Chrome\";\n\t fullVersion = nAgt.substring(verOffset+7);\n\t}\n\t// In Safari, the true version is after \"Safari\" or after \"Version\"\n\telse if ((verOffset=nAgt.indexOf(\"Safari\"))!=-1) {\n\t browserName = \"Safari\";\n\t fullVersion = nAgt.substring(verOffset+7);\n\t if ((verOffset=nAgt.indexOf(\"Version\"))!=-1)\n\t   fullVersion = nAgt.substring(verOffset+8);\n\t}\n\t// In Firefox, the true version is after \"Firefox\"\n\telse if ((verOffset=nAgt.indexOf(\"Firefox\"))!=-1) {\n\t browserName = \"Firefox\";\n\t fullVersion = nAgt.substring(verOffset+8);\n\t}\n\t// In most other browsers, \"name/version\" is at the end of userAgent\n\telse if ( (nameOffset=nAgt.lastIndexOf(' ')+1) <\n\t\t   (verOffset=nAgt.lastIndexOf('/')) )\n\t{\n\t browserName = nAgt.substring(nameOffset,verOffset);\n\t fullVersion = nAgt.substring(verOffset+1);\n\t if (browserName.toLowerCase()==browserName.toUpperCase()) {\n\t  browserName = navigator.appName;\n\t }\n\t}\n\t// trim the fullVersion string at semicolon/space if present\n\tif ((ix=fullVersion.indexOf(\";\"))!=-1)\n\t   fullVersion=fullVersion.substring(0,ix);\n\tif ((ix=fullVersion.indexOf(\" \"))!=-1)\n\t   fullVersion=fullVersion.substring(0,ix);\n\n\tmajorVersion = parseInt(''+fullVersion,10);\n\tif (isNaN(majorVersion)) {\n\t fullVersion  = ''+parseFloat(navigator.appVersion);\n\t majorVersion = parseInt(navigator.appVersion,10);\n\t}\n\n\n\treturn browserName;\n}\n"]}